# ë°ì´í„° í”Œë¡œìš°

## 1. ë§í¬ ì €ì¥ í”Œë¡œìš° (ì „ì²´)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App    â”‚ ì‚¬ìš©ìê°€ ìœ íŠœë¸Œ/ì›¹ì—ì„œ ê³µìœ  ë²„íŠ¼ í´ë¦­
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ 1. POST /api/v1/links
      â”‚    {
      â”‚      "url": "https://youtube.com/watch?v=xxx",
      â”‚      "source": "youtube_share"
      â”‚    }
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Server  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 2. JWT í† í° ê²€ì¦
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis     â”‚ GET user:{user_id}:session
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ âœ“ ì¸ì¦ ì„±ê³µ
      â”‚
      â”‚ 3. URL ì¤‘ë³µ ì²´í¬
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ SELECT * FROM links 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  WHERE url_hash = SHA256(url) AND user_id = ?
      â”‚
      â”‚ ì¤‘ë³µ ì—†ìŒ
      â”‚ 4. ê¸°ë³¸ ì •ë³´ë§Œ DBì— ì €ì¥
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ INSERT INTO links (
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   user_id, url, url_hash, status='pending'
                ) RETURNING id
      â”‚
      â”‚ link_id = 12345
      â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                                         â”‚
      â”‚ 5. ì¦‰ì‹œ ì‘ë‹µ (ì‚¬ìš©ìëŠ” ê¸°ë‹¤ë¦¬ì§€ ì•ŠìŒ)     â”‚
      â†“                                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚   App    â”‚ âœ“ ì €ì¥ ì™„ë£Œ! (link_id: 12345)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
                                               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 6. ë°±ê·¸ë¼ìš´ë“œ Job ë°œí–‰
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RabbitMQ   â”‚ PUBLISH to 'scrape.queue'
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  {
      â”‚            "job_id": "uuid-1",
      â”‚            "link_id": 12345,
      â”‚            "url": "https://...",
      â”‚            "task_type": "scrape"
      â”‚          }
      â”‚
      â”‚ 7. Workerê°€ Job ìˆ˜ì‹ 
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Worker    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 8. ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€ Lock
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis     â”‚ SET lock:scrape:{url_hash} EX 300 NX
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ âœ“ Lock íšë“
      â”‚
      â”‚ 9. ë§í¬ ìƒíƒœ ì—…ë°ì´íŠ¸
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ UPDATE links SET status='scraping'
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  WHERE id = 12345
      â”‚
      â”‚ 10. URL ì ‘ì† ë° í¬ë¡¤ë§
      â†“
  [Target Website]
      â”‚ HTML íŒŒì‹±
      â”‚ - <title>
      â”‚ - <meta property="og:description">
      â”‚ - <meta property="og:image">
      â”‚ - <meta property="author">
      â”‚
      â”‚ 11. ë©”íƒ€ë°ì´í„° ì €ì¥
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ UPDATE links SET
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   title = 'Amazing Video',
                  description = '...',
                  thumbnail_original_url = 'https://...',
                  author = 'Channel Name',
                  status = 'scraping_completed'
      â”‚
      â”‚ 12. ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ Job ë°œí–‰
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RabbitMQ   â”‚ PUBLISH to 'thumbnail.queue'
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ 13. Workerê°€ ì¸ë„¤ì¼ ì²˜ë¦¬
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Worker    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 14. ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
      â†“
  [Download Image from thumbnail_original_url]
      â”‚
      â”‚ 15. ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§• (3ê°€ì§€ ì‚¬ì´ì¦ˆ)
      â”‚     - small: 150x150
      â”‚     - medium: 300x300
      â”‚     - large: 600x600
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MinIO     â”‚ PUT /thumbnails/resized/small/12345_hash.jpg
â”‚             â”‚ PUT /thumbnails/resized/medium/12345_hash.jpg
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ PUT /thumbnails/resized/large/12345_hash.jpg
      â”‚
      â”‚ 16. ì´ë¯¸ì§€ ê²½ë¡œ ì €ì¥
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ INSERT INTO stored_images (
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   link_id, bucket, object_key, image_type, ...
                )
                UPDATE links SET
                  thumbnail_storage_path = '/thumbnails/...'
      â”‚
      â”‚ 17. AI íƒœê·¸ ìƒì„± Job ë°œí–‰
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RabbitMQ   â”‚ PUBLISH to 'tag.queue'
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ 18. Workerê°€ íƒœê·¸ ìƒì„±
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Worker    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 19. OpenAI API í˜¸ì¶œ
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenAI API â”‚ POST /v1/chat/completions
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  {
      â”‚            "model": "gpt-4o-mini",
      â”‚            "messages": [{
      â”‚              "role": "system",
      â”‚              "content": "íƒœê·¸ ìƒì„± AI"
      â”‚            }, {
      â”‚              "role": "user",
      â”‚              "content": "ì œëª©: ..., ì„¤ëª…: ..."
      â”‚            }]
      â”‚          }
      â”‚
      â”‚ Response:
      â”‚ {
      â”‚   "category": "ê¸°ìˆ ",
      â”‚   "content_type": "íŠœí† ë¦¬ì–¼",
      â”‚   "keywords": ["React", "JavaScript", "ì›¹ê°œë°œ"],
      â”‚   "mood": "ì‹¤ìš©ì ",
      â”‚   "difficulty": "ì¤‘ê¸‰"
      â”‚ }
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Worker    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 20. íƒœê·¸ ì €ì¥ (íŠ¸ëœì­ì…˜)
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ BEGIN;
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 
                -- íƒœê·¸ê°€ ì—†ìœ¼ë©´ ìƒì„±
                INSERT INTO tags (name, category, ...)
                  ON CONFLICT (name) DO NOTHING;
                
                -- ë§í¬-íƒœê·¸ ì—°ê²°
                INSERT INTO link_tags (
                  link_id, tag_id, 
                  is_auto_generated=true,
                  confidence=0.95
                );
                
                -- ë§í¬ ìƒíƒœ ìµœì¢… ì—…ë°ì´íŠ¸
                UPDATE links SET 
                  status = 'completed',
                  updated_at = NOW()
                WHERE id = 12345;
                
                COMMIT;
      â”‚
      â”‚ 21. ìºì‹œ ë¬´íš¨í™”
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis     â”‚ DEL cache:link:12345
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ DEL cache:links:user:{user_id}:*
      â”‚
      â”‚ 22. Lock í•´ì œ
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis     â”‚ DEL lock:scrape:{url_hash}
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ 23. WebSocket ì•Œë¦¼ (Optional)
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App    â”‚ ğŸ”” "íƒœê·¸ ìƒì„± ì™„ë£Œ!"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    ìƒˆë¡œê³ ì¹¨ ë˜ëŠ” ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
```

**ì†Œìš” ì‹œê°„**:
- ì‚¬ìš©ì ì €ì¥ ìš”ì²­ â†’ ì‘ë‹µ: **< 500ms**
- ì „ì²´ ì²˜ë¦¬ (í¬ë¡¤ë§ + íƒœê·¸): **5-15ì´ˆ**

## 2. ë§í¬ ëª©ë¡ ì¡°íšŒ í”Œë¡œìš° (ìºì‹±)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ GET /api/v1/links?page=1&tag=tech&limit=20
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Server  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 1. ì¸ì¦ í™•ì¸
      â”‚ 2. ìºì‹œ í‚¤ ìƒì„±
      â”‚    cache_key = "cache:links:user:123:page:1:tag:tech:limit:20"
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis     â”‚ GET cache_key
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”œâ”€ Cache HIT (ìºì‹œ ìˆìŒ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                                  â”‚
      â”‚                                  â†“
      â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                        â”‚ API Server  â”‚
      â”‚                        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                              â”‚ JSON íŒŒì‹±
      â”‚                              â”‚ ì¦‰ì‹œ ì‘ë‹µ
      â”‚                              â†“
      â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                        â”‚   App    â”‚ âš¡ ë¹ ë¦„! (~50ms)
      â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â””â”€ Cache MISS (ìºì‹œ ì—†ìŒ)
      â”‚ 3. DB ì¿¼ë¦¬
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ SELECT l.*, array_agg(t.name) as tags
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ FROM links l
                LEFT JOIN link_tags lt ON l.id = lt.link_id
                LEFT JOIN tags t ON lt.tag_id = t.id
                WHERE l.user_id = 123
                  AND l.deleted_at IS NULL
                  AND (t.name = 'tech' OR 'tech' IS NULL)
                GROUP BY l.id
                ORDER BY l.created_at DESC
                LIMIT 20 OFFSET 0;
      â”‚
      â”‚ 4. ì¸ë„¤ì¼ URL ìƒì„±
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MinIO     â”‚ Generate Pre-signed URLs
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  (ë§Œë£Œ: 1ì‹œê°„)
      â”‚
      â”‚ {
      â”‚   "id": 12345,
      â”‚   "title": "...",
      â”‚   "thumbnail_url": "http://minio:9000/thumbnails/.../12345.jpg?X-Amz-Expires=3600&..."
      â”‚ }
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Server  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 5. ìºì‹œ ì €ì¥ (TTL: 5ë¶„)
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis     â”‚ SET cache_key <JSON> EX 300
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 6. ì‘ë‹µ
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App    â”‚ (~200ms)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. íƒœê·¸ë³„ í•„í„°ë§ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App    â”‚ ì‚¬ìš©ìê°€ 'ê¸°ìˆ ' íƒœê·¸ í´ë¦­
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ GET /api/v1/tags/tech/links?page=1
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Server  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 1. ìºì‹œ í™•ì¸
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis     â”‚ GET cache:tag:tech:links:page:1
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ Cache MISS
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ SELECT l.*
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ FROM links l
                INNER JOIN link_tags lt ON l.id = lt.link_id
                INNER JOIN tags t ON lt.tag_id = t.id
                WHERE t.name = 'tech'
                  AND l.user_id = 123
                  AND l.deleted_at IS NULL
                ORDER BY l.created_at DESC
                LIMIT 20;
      â”‚
      â†“
      (MinIO URL ìƒì„±, ìºì‹±, ì‘ë‹µ)
```

## 4. ê²€ìƒ‰ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App    â”‚ ì‚¬ìš©ìê°€ "React hooks" ê²€ìƒ‰
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ GET /api/v1/search?q=React+hooks
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Server  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 1. ê²€ìƒ‰ì–´ ì •ê·œí™”
      â”‚    "react hooks" â†’ ["react", "hooks"]
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ SELECT l.*, 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   ts_rank(
                    to_tsvector('english', l.title || ' ' || l.description),
                    to_tsquery('english', 'react & hooks')
                  ) AS rank
                FROM links l
                WHERE to_tsvector('english', l.title || ' ' || l.description)
                  @@ to_tsquery('english', 'react & hooks')
                  AND l.user_id = 123
                ORDER BY rank DESC, l.created_at DESC
                LIMIT 20;
      â”‚
      â†“
      (ì‘ë‹µ)
```

## 5. ë™ê¸°í™” í”Œë¡œìš° (Pull)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App    â”‚ ì•± ì‹œì‘ ì‹œ ë˜ëŠ” ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ 1. ë§ˆì§€ë§‰ ë™ê¸°í™” ì‹œê°„ í™•ì¸ (ë¡œì»¬ DB)
      â”‚    last_sync = "2025-10-05T09:00:00Z"
      â”‚
      â”‚ 2. ì„œë²„ì— ë³€ê²½ì‚¬í•­ ìš”ì²­
      â”‚ GET /api/v1/sync/pull?since=2025-10-05T09:00:00Z
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Server  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 3. ë³€ê²½ëœ ë§í¬ ì¡°íšŒ
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ SELECT * FROM links
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ WHERE user_id = 123
                  AND updated_at > '2025-10-05T09:00:00Z'
                  AND deleted_at IS NULL
                ORDER BY updated_at ASC;
      â”‚
      â”‚ 4. ì¸ë„¤ì¼ URL í¬í•¨
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MinIO     â”‚ Generate Pre-signed URLs
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”‚ 5. ì‘ë‹µ
      â”‚ {
      â”‚   "links": [...],
      â”‚   "sync_timestamp": "2025-10-05T10:30:00Z"
      â”‚ }
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ 6. ë¡œì»¬ DB ì—…ë°ì´íŠ¸ (SQLite)
      â”‚    - ìƒˆ ë§í¬ INSERT
      â”‚    - ê¸°ì¡´ ë§í¬ UPDATE
      â”‚    - ì‚­ì œëœ ë§í¬ ì²˜ë¦¬
      â”‚
      â”‚ 7. last_sync ì—…ë°ì´íŠ¸
      â†“
  [Local SQLite]
```

## 6. ë™ê¸°í™” í”Œë¡œìš° (Push)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App    â”‚ ì‚¬ìš©ìê°€ ì˜¤í”„ë¼ì¸ì—ì„œ ë©”ëª¨ ì¶”ê°€
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ ë¡œì»¬ DBì— ì €ì¥
      â”‚ sync_pending = true
      â”‚
      â”‚ (ë‚˜ì¤‘ì— ë„¤íŠ¸ì›Œí¬ ì—°ê²°)
      â”‚
      â”‚ POST /api/v1/sync/push
      â”‚ {
      â”‚   "changes": [{
      â”‚     "link_id": 12345,
      â”‚     "type": "note_update",
      â”‚     "content": "ì´ ì˜ìƒ ë‚˜ì¤‘ì— ë‹¤ì‹œ ë³´ê¸°",
      â”‚     "timestamp": "2025-10-05T10:15:00Z"
      â”‚   }]
      â”‚ }
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ API Server  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 1. ì¶©ëŒ ê°ì§€
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ SELECT version, updated_at
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ FROM links WHERE id = 12345;
      â”‚
      â”‚ version = 3, updated_at = "2025-10-05T10:00:00Z"
      â”‚ í´ë¼ì´ì–¸íŠ¸ timestamp = "2025-10-05T10:15:00Z"
      â”‚ â†’ ì¶©ëŒ ì—†ìŒ (ì„œë²„ê°€ ë” ì˜¤ë˜ë¨)
      â”‚
      â”‚ 2. ì—…ë°ì´íŠ¸
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ UPDATE notes SET content = '...'
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ WHERE link_id = 12345;
                
                UPDATE links SET 
                  version = version + 1,
                  updated_at = NOW()
                WHERE id = 12345;
      â”‚
      â”‚ 3. ì‘ë‹µ
      â”‚ { "status": "success", "new_version": 4 }
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App    â”‚ sync_pending = false
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 7. ì‹¤íŒ¨ ì²˜ë¦¬ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Worker    â”‚ URL í¬ë¡¤ë§ ì¤‘ ì—ëŸ¬ ë°œìƒ
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ Exception: Timeout or 404
      â”‚
      â”‚ 1. ì¬ì‹œë„ ì¹´ìš´íŠ¸ ì¦ê°€
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL   â”‚ UPDATE links SET
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   retry_count = retry_count + 1
                WHERE id = 12345;
      â”‚
      â”‚ retry_count < 3 ?
      â”‚
      â”œâ”€ YES â†’ ì¬ì‹œë„
      â”‚          â†“
      â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚   â”‚  RabbitMQ   â”‚ PUBLISH to 'scrape.queue'
      â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (delay: 30ì´ˆ)
      â”‚
      â””â”€ NO â†’ ì‹¤íŒ¨ ì²˜ë¦¬
                â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ PostgreSQL   â”‚ UPDATE links SET
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   status = 'failed',
                            processing_error = '...'
                â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  RabbitMQ   â”‚ PUBLISH to 'dlq.queue'
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ (ìˆ˜ë™ ì²˜ë¦¬ ëŒ€ê¸°)
                â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   App    â”‚ ğŸ”” "ë§í¬ ì²˜ë¦¬ ì‹¤íŒ¨: í™•ì¸ í•„ìš”"
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## í”Œë¡œìš° ìš”ì•½

| ì‘ì—… | ë™ê¸°/ë¹„ë™ê¸° | í‰ê·  ì†Œìš”ì‹œê°„ | ìºì‹± ì—¬ë¶€ |
|------|------------|--------------|----------|
| ë§í¬ ì €ì¥ (ì‘ë‹µ) | ë™ê¸° | < 500ms | âŒ |
| ì „ì²´ ì²˜ë¦¬ | ë¹„ë™ê¸° | 5-15ì´ˆ | âŒ |
| ëª©ë¡ ì¡°íšŒ (ìºì‹œ íˆíŠ¸) | ë™ê¸° | ~50ms | âœ… |
| ëª©ë¡ ì¡°íšŒ (ìºì‹œ ë¯¸ìŠ¤) | ë™ê¸° | ~200ms | âœ… |
| ê²€ìƒ‰ | ë™ê¸° | ~300ms | âŒ |
| ë™ê¸°í™” (Pull) | ë™ê¸° | 1-3ì´ˆ | âŒ |
| ë™ê¸°í™” (Push) | ë™ê¸° | ~500ms | âŒ |